<template>
  <div class="container">
    <div class="left"></div>
    <div class="right">
      <div class="form">
        <!-- logo -->
        <svg
          width="125"
          height="24"
          viewBox="0 0 125 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M8.8466 10.2837H3.18681C3.0573 10.2835 2.93173 10.3267 2.83157 10.406C2.73141 10.4852 2.66287 10.5956 2.63766 10.7181L0.0106051 23.3507C-0.00540262 23.4293 -0.00326594 23.5102 0.0168629 23.5879C0.0369917 23.6655 0.0746173 23.7379 0.127059 23.7999C0.1795 23.8619 0.245467 23.912 0.320259 23.9466C0.395051 23.9812 0.476828 23.9994 0.559763 24H1.00008C1.09936 24.0031 1.19767 23.9803 1.2847 23.9341C1.37174 23.8879 1.44431 23.82 1.49481 23.7374L9.32649 11.1001C9.37724 11.0182 9.40458 10.9248 9.40572 10.8294C9.40685 10.734 9.38175 10.64 9.33297 10.557C9.28418 10.474 9.21347 10.405 9.12802 10.357C9.04258 10.309 8.94547 10.2837 8.8466 10.2837Z"
            fill="#2CD400"
          />
          <path
            d="M17.876 10.1643C18.628 9.96632 19.2916 9.53514 19.7646 8.93725C20.2375 8.33936 20.4935 7.60796 20.4932 6.85578V3.55679C20.4945 2.61721 20.11 1.7154 19.4238 1.04878C18.7377 0.382164 17.8058 0.00505121 16.8321 5.56639e-07H5.31962C5.1901 -0.000178909 5.06454 0.0430428 4.96438 0.122282C4.86422 0.201522 4.79568 0.311862 4.77046 0.434455L3.5732 6.20649C3.55709 6.28478 3.55919 6.36554 3.57934 6.44295C3.5995 6.52036 3.6372 6.5925 3.68973 6.65415C3.74226 6.7158 3.80831 6.76544 3.88312 6.79948C3.95794 6.83352 4.03964 6.85112 4.12236 6.85101H16.0356C16.1308 6.85168 16.2242 6.87579 16.307 6.92105C16.3898 6.9663 16.4593 7.03121 16.5088 7.10962C16.5583 7.18802 16.5863 7.27734 16.5901 7.3691C16.5939 7.46086 16.5733 7.55203 16.5303 7.63398L8.46614 23.217C8.42319 23.299 8.40262 23.3901 8.4064 23.4819C8.41017 23.5737 8.43815 23.663 8.48769 23.7414C8.53724 23.8198 8.6067 23.8847 8.68951 23.93C8.77231 23.9752 8.86572 23.9993 8.96088 24H16.8321C17.8097 24 18.7472 23.6253 19.4384 22.9582C20.1296 22.2912 20.5179 21.3865 20.5179 20.4432V13.7116C20.5183 12.9594 20.2622 12.228 19.7893 11.6301C19.3163 11.0322 18.6527 10.601 17.9008 10.403C17.8728 10.3987 17.8471 10.3855 17.8276 10.3656C17.8082 10.3456 17.7962 10.3201 17.7933 10.2928C17.7905 10.2656 17.7971 10.2383 17.812 10.215C17.827 10.1918 17.8495 10.1739 17.876 10.1643Z"
            fill="#006FEE"
          />
          <path
            d="M28.9376 20V5.76H35.4976C36.9642 5.76 38.1309 6.09333 38.9976 6.76C39.8642 7.41333 40.2976 8.31333 40.2976 9.46C40.2976 10.2467 40.0776 10.9333 39.6376 11.52C39.1976 12.0933 38.5842 12.4933 37.7976 12.72V12.56C38.7176 12.7733 39.4242 13.1867 39.9176 13.8C40.4242 14.4133 40.6776 15.18 40.6776 16.1C40.6776 17.3 40.2309 18.2533 39.3376 18.96C38.4576 19.6533 37.2442 20 35.6976 20H28.9376ZM31.9976 17.6H35.3376C36.1776 17.6 36.7842 17.46 37.1576 17.18C37.5442 16.9 37.7376 16.44 37.7376 15.8C37.7376 15.1733 37.5442 14.7133 37.1576 14.42C36.7842 14.1133 36.1776 13.96 35.3376 13.96H31.9976V17.6ZM31.9976 11.56H34.9776C35.7909 11.56 36.3842 11.42 36.7576 11.14C37.1442 10.86 37.3376 10.4333 37.3376 9.86C37.3376 9.27333 37.1442 8.84667 36.7576 8.58C36.3709 8.3 35.7776 8.16 34.9776 8.16H31.9976V11.56ZM48.3234 20.18C46.31 20.18 44.7834 19.6667 43.7434 18.64C42.7167 17.6133 42.2034 16.1067 42.2034 14.12V5.76H45.2434V14.26C45.2434 15.3933 45.5034 16.26 46.0234 16.86C46.5434 17.46 47.31 17.76 48.3234 17.76C49.2967 17.76 50.0434 17.46 50.5634 16.86C51.0834 16.26 51.3434 15.3933 51.3434 14.26V5.76H54.4434V14.12C54.4434 16.0933 53.9167 17.6 52.8634 18.64C51.81 19.6667 50.2967 20.18 48.3234 20.18ZM56.5852 20V5.76H59.7052V20H56.5852ZM61.9618 20V5.76H65.0818V17.46H71.4418V20H61.9618ZM72.7485 20V5.76H78.2685C79.8285 5.76 81.1618 6.04 82.2685 6.6C83.3885 7.16 84.2418 7.97333 84.8285 9.04C85.4285 10.0933 85.7285 11.3667 85.7285 12.86C85.7285 14.3667 85.4352 15.6533 84.8485 16.72C84.2618 17.7733 83.4085 18.5867 82.2885 19.16C81.1818 19.72 79.8418 20 78.2685 20H72.7485ZM75.8685 17.48H78.0485C79.5685 17.48 80.7085 17.1 81.4685 16.34C82.2285 15.5667 82.6085 14.4067 82.6085 12.86C82.6085 9.80667 81.0885 8.28 78.0485 8.28H75.8685V17.48ZM90.0574 20V8.3H85.5974V5.76H97.6774V8.3H93.2174V20H90.0574ZM98.4391 20H95.2991L101.839 5.76H104.359L110.899 20H107.799L102.759 8.24H103.519L98.4391 20ZM98.2591 16.84L99.4591 14.46H106.579L107.759 16.84H98.2591ZM111.515 20V5.76H118.075C119.542 5.76 120.708 6.09333 121.575 6.76C122.442 7.41333 122.875 8.31333 122.875 9.46C122.875 10.2467 122.655 10.9333 122.215 11.52C121.775 12.0933 121.162 12.4933 120.375 12.72V12.56C121.295 12.7733 122.002 13.1867 122.495 13.8C123.002 14.4133 123.255 15.18 123.255 16.1C123.255 17.3 122.808 18.2533 121.915 18.96C121.035 19.6533 119.822 20 118.275 20H111.515ZM114.575 17.6H117.915C118.755 17.6 119.362 17.46 119.735 17.18C120.122 16.9 120.315 16.44 120.315 15.8C120.315 15.1733 120.122 14.7133 119.735 14.42C119.362 14.1133 118.755 13.96 117.915 13.96H114.575V17.6ZM114.575 11.56H117.555C118.368 11.56 118.962 11.42 119.335 11.14C119.722 10.86 119.915 10.4333 119.915 9.86C119.915 9.27333 119.722 8.84667 119.335 8.58C118.948 8.3 118.355 8.16 117.555 8.16H114.575V11.56Z"
            fill="white"
          />
        </svg>
        <h1>Welcome back</h1>
        <p style="color: #ffff">
          The leading provider of 3D digitization technology solutions in
          Vietnam.
        </p>
        <!--  -->
        <div>
          <!-- username -->
          <div class="input_container">
            <div class="email input_label">
              Email
              <span style="color: red">*</span>
            </div>
            <div class="input_wrapper">
              <img class="input_icon" src="@/assets/email.png" />
              <input
                class="input_input"
                type="email"
                placeholder="Username"
                v-model="username"
                v-bind:class="{ 'error-username': usernameError }"
                required
              />
            </div>
            <!-- show error -->
            <p class="error-username style" v-if="usernameError">
              {{ usernameError }}
            </p>
          </div>
          <!-- password -->
          <div class="input_container">
            <div class="password input_label">
              Password
              <span style="color: red">*</span>
            </div>
            <div class="input_wrapper">
              <img class="input_icon" src="@/assets/password.png" />
              <input
                class="input_input"
                type="password"
                placeholder="Password"
                v-model="password"
                v-bind:class="{ 'error-password': passwordError }"
                required
              />
              <button>
                <img class="input_icon" src="@/assets/eye.png" />
              </button>
            </div>
            <!-- show error -->
            <p class="error-password color" v-if="passwordError">
              {{ passwordError }}
            </p>
          </div>
          <!-- show password -->
          <!-- more -->
          <div class="login-features">
            <button style="color: #ffff" v-on:click="isShowSave">
              Remember me
            </button>
            <button style="text-decoration: underline; color: #ffff">
              Forgot password?
            </button>
          </div>
          <!-- button login -->
          <div class="login-button">
            <button
              v-on:click.prevent="submitForm"
              :disabled="disabled"
              class="login-text"
            >
              LOGIN
            </button>
          </div>
        </div>
        <!--  -->
      </div>
    </div>
    <!-- success login -->
    <div class="background-message" v-if="successMessage">
      <div class="box-message">
        <h1 class="success">CHÚC MỪNG !</h1>
        <h2 class="message success">Đăng nhập thành công</h2>
        <div class="btn-message">
          <button v-on:click="stateSuccess">Ok</button>
        </div>
      </div>
      <!-- <p>Dang nhap thanh cong</p> -->
    </div>
    <!-- failed -->
    <div class="background-message" v-if="failedLogin">
      <div class="box-message">
        <h2 class="message notification">ĐĂNG NHẬP THẤT BẠI</h2>
        <span class="message note"
          >Đã xảy ra lỗi trong quá trình đăng nhập</span
        >
        <span class="message note">Vui lòng đăng nhập lại.</span>
        <div class="btn-message">
          <button v-on:click="stateFailed">Ok</button>
        </div>
      </div>
    </div>
    <!--  -->
  </div>
</template>

<script>
import axios from "axios";
export default {
  data() {
    return {
      username: "",
      password: "",
      usernameError: "",
      passwordError: "",
      successMessage: false,
      failedLogin: false,
      const: 0,
      disabled: false,
      error: null,
    };
  },
  mounted() {
    //
  },
  //
  methods: {
    submitForm() {
      if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.username)) {
        this.usernameError = "Email không đúng định dạng !";
        return;
      } else {
        this.usernameError = "";
      }
      if (this.password.length < 8) {
        this.passwordError = "* Vui lòng nhập mật khẩu dài ít nhất 8 ký tự !";
      } else if (
        !(
          /[a-z]/.test(this.password) &&
          /[A-Z]/.test(this.password) &&
          /[0-9]/.test(this.password) &&
          /[^a-zA-Z0-9]/.test(this.password)
        )
      ) {
        this.passwordError =
          "* Mật khẩu cần có chữ hoa, thường, số và ký tự đặc biệt !";
      } else {
        this.postData();
      }
    },
    // --------------------------------------------------------------------
    postData: async function () {
      const responseLogin = await axios
        .post(
          "https://dev-crawler-api.trainery.live//master-caoanh/auth/login",
          {
            email: this.username,
            password: this.password,
          }
        )
        .then((responseLogin) => {
          if (responseLogin.status === 200) {
            console.log(responseLogin.status);
            this.successMessage = true;
            // localStorage.setItem('key', 'value'); :Để lưu trữ dữ liệu vào LocalStorage, bạn sử dụng phương thức setItem():
            // Lưu thông tin token
            localStorage.setItem(
              "LoginInfo",
              JSON.stringify(responseLogin.data.data)
            );
            // call API user
          }
        })
        .catch((error) => {
          this.const++;
          console.log(this.const);
          if (error.response.status === 401 || error.response.status === 422) {
            this.failedLogin = true;
            this.passwordError = "* Thông tin đăng nhập không đúng !";
          } else if (error.response.status === 500) {
            alert("Máy chủ gặp sự cố, hiện không phải hồi !");
          } else {
            //
          }
          if (this.const >= 3) {
            this.disabled = true;
            this.passwordError =
              "* CẢNH BÁO ! Bạn đã bị giới hạn đăng nhập do nhập sai thông tin quá nhiều lần.";
          }
        });
    },
    // state login
    stateFailed() {
      this.failedLogin = !this.failedLogin;
    },
    stateSuccess() {
      this.$router.push("/");
    },
    isShowSave() {
      alert("Đã lưu thông tin !");
    },
  },
};
</script>


<style scoped>
.container {
  max-width: 1440px;
  height: 100vh;
  background-color: #ffffff;
  display: grid;
  grid-template-columns: 1fr 1fr;
  position: relative;
}
.left {
  background-image: url("@/assets/image.png");
  background-size: 100% 100%;
}
.right {
  background-image: url("@/assets/login_background.png");
  background-size: 100% 100%;
  display: flex;
  justify-content: center;
  align-items: center;
}
.form {
  display: flex;
  flex-direction: column;
  width: 50%;
  min-width: 320px !important;
}
.input_container {
  position: relative;
}
.input_label {
  color: #ffffff;
  font-weight: 600;
  font-size: 12px;
  background: #1c1c1e;
  position: absolute;
  left: 20px;
  top: -10px;
}
.email {
  max-width: 45px;
}
.password {
  max-width: 70px;
}
.input_wrapper {
  border: 1px solid #006fed;
  box-sizing: border-box;
  border-radius: 4px;
  width: 100%;
  display: flex;
  padding: 12px 8px 12px 8px;
  margin-top: 30px;
}
.input_icon {
  height: 22px;
  width: 22px;
}
.input_input {
  width: 100%;
  background-color: transparent;
  border: none !important;
  margin-left: 8px;
  color: #ffffff;
}
.login-button {
  background-color: rgba(0, 111, 237, 1);
  height: 46px;
  margin-top: 30px;
  border-radius: 4px;
  display: flex;
  justify-content: center;
  align-items: center;
}
.login-button:hover {
  background-color: #ffffff;
  transition: all 0.4s;
}
.login-button:hover button {
  color: #006fed;
  transition: all 0.4s;
}
.login-text {
  font-weight: bold;
  color: white;
  font-size: 18px;
}
.login-features {
  margin-top: 5px;
  display: flex;
  justify-content: space-between;
}
.style {
  color: red;
  font-size: 13px;
  font-weight: 500;
}
/* message */
.background-message {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  background-color: rgb(139, 214, 236);
}
.box-message {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  border-radius: 5%;
  width: 360px;
  height: 200px;
  background-color: #ffffff;
}
.message {
  display: flex;
  align-items: center;
  justify-content: center;
}
.notification {
  font-weight: 700;
  font-size: 30px;
}
.note {
  font-size: 15px;
  margin-top: 10px;
}
.btn-message {
  position: absolute;
  height: 50px;
  bottom: 0px;
  left: 0;
  right: 0;
  font-size: 30px;
  display: flex;
  justify-content: center;
  font-weight: 500;
  color: #006fed;
  border-top: solid 0.5px rgb(199, 213, 214);
}
.success {
  font-size: 26px;
  font-weight: 700;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #1c1c1e;
}
/*  */
.error-password {
  font-size: 13px;
  font-weight: 500;
}
.color {
  color: red;
}
p {
  margin: 10px 0;
}
h1 {
  color: rgba(0, 111, 237, 1);
  font-size: 45px;
  font-weight: 500;
  line-height: 40px;
  margin-top: 15px;
}
h2 {
  margin-top: 20px;
}
</style>